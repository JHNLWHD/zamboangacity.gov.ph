function getFolders(e){return filesystem.readdirSync(e).filter(function(n){return filesystem.statSync(path.join(e,n)).isDirectory()})}var gulp=require("gulp"),path=require("path"),filesystem=require("fs"),wpPot=require("gulp-wp-pot"),gettext=require("gulp-gettext"),sort=require("gulp-sort"),pofill=require("gulp-pofill"),rename=require("gulp-rename"),clean=require("gulp-clean"),languagesFolder="./languages/",options=require("./transifex-config.json"),transifex=require("gulp-transifex").createClient(options);gulp.task("prepare-source",function(){return gulp.src("**/*.php").pipe(sort()).pipe(wpPot({destFile:"freemius.pot",package:"freemius",bugReport:"https://github.com/Freemius/wordpress-sdk/issues",lastTranslator:"Vova Feldman <vova@freemius.com>",team:"Freemius Team <admin@freemius.com>",gettextFunctions:[{name:"get_text_inline"},{name:"fs_text_inline"},{name:"fs_echo_inline"},{name:"fs_esc_js_inline"},{name:"fs_esc_attr_inline"},{name:"fs_esc_attr_echo_inline"},{name:"fs_esc_html_inline"},{name:"fs_esc_html_echo_inline"},{name:"get_text_x_inline",context:2},{name:"fs_text_x_inline",context:2},{name:"fs_echo_x_inline",context:2},{name:"fs_esc_attr_x_inline",context:2},{name:"fs_esc_js_x_inline",context:2},{name:"fs_esc_js_echo_x_inline",context:2},{name:"fs_esc_html_x_inline",context:2},{name:"fs_esc_html_echo_x_inline",context:2}]})).pipe(gulp.dest(languagesFolder+"freemius.pot")),gulp.src(languagesFolder+"freemius.pot").pipe(pofill({items:function(e){return e.msgstr.length||(e.msgstr=[""]),e.msgstr[0]||(e.msgstr[0]=e.msgid),e}})).pipe(rename("freemius-en.po")).pipe(gulp.dest(languagesFolder))}),gulp.task("update-transifex",["prepare-source"],function(){return gulp.src(languagesFolder+"freemius-en.po").pipe(transifex.pushResource())}),gulp.task("download-translations",["update-transifex"],function(){return gulp.src(languagesFolder+"freemius-en.po").pipe(transifex.pullResource())}),gulp.task("prepare-translations",["download-translations"],function(){return getFolders(languagesFolder).map(function(e){return gulp.src(path.join(languagesFolder,e,"freemius-en.po")).pipe(rename("freemius-"+e+".po")).pipe(gulp.dest(languagesFolder))})}),gulp.task("translations-feelup",["prepare-translations"],function(){return gulp.src(languagesFolder+"*.po").pipe(pofill({items:function(e){return 0==e.msgstr.length&&(e.msgstr=[""]),0==e.msgstr[0].length&&(e.msgstr[0]=e.msgid),e}})).pipe(gulp.dest(languagesFolder))}),gulp.task("cleanup",["prepare-translations"],function(){return getFolders(languagesFolder).map(function(e){return gulp.src(path.join(languagesFolder,e),{read:!1}).pipe(clean())})}),gulp.task("compile-translations",["translations-feelup"],function(){return gulp.src(languagesFolder+"*.po").pipe(gettext()).pipe(gulp.dest(languagesFolder))}),gulp.task("default",[],function(){gulp.run("prepare-source"),gulp.run("update-transifex"),gulp.run("download-translations"),gulp.run("prepare-translations"),gulp.run("translations-feelup"),gulp.run("cleanup"),gulp.run("compile-translations")});